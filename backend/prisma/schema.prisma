generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////
// ENUMS GENERALES //
//////////////////////

enum Role {
  ADMIN
  TECHNICIAN
  OPERATOR
  VIEWER
}

enum MedioReporte {
  PERSONAL
  TELEFONICO
  ESCRITO
  CORREO_ELECTRONICO
  WHATSAPP
  AUTONOMO
}

enum Condicion {
  APAGADA
  ENCENDIDA_24H
  INTERMITENTE
  POCA_ILUMINACION
  BAJA_INTENSIDAD
  PARPADEO
  FALLA_ELECTRICA
  FALLA_FOTOCONTROL
  LUMINARIA_DANADA
  LUMINARIA_CAIDA
  POSTE_INCLINADO
  POSTE_CAIDO
  VANDALISMO
  HURTO_LUMINARIA
  HURTO_CABLEADO
  OBSTRUCCION_ARBOL
  ACCIDENTE_TRANSITO
  LUMINARIA_INEXISTENTE
  SOLICITUD_NUEVA
  REUBICACION
  APOYO_MUNICIPAL
  MANTENIMIENTO_PREVENTIVO
  REVISION_TECNICA
  RECLAMACION_IAP
  DERECHO_DE_PETICION
  INFORMACION
  OTRO
  REPOTENCIACION
  MODERNIZACION
  RECLAMO_IMPUESTO
  SERVICIO_AP
}

enum TipoPqr {
  PETICION
  QUEJA
  RECLAMO
  REPORTE
}

enum EstadoPqr {
  PENDIENTE
  EN_PROCESO
  PROCESADA
}

enum SectorPqr {
  CABECERA_MUNICIPAL
  OCHALI
  EL_PUEBLITO
  EL_CEDRO
  CEDENO
  LLANOS_DE_CUIVA
  LA_LOMA
}

enum PrioridadPqr {
  BAJA
  MEDIA
  ALTA
  CRITICA
}

////////////////////////
// ENUMS INVENTARIO //
////////////////////////

enum TipoInventario {
  LUMINARIA
  POSTE
  TRANSFORMADOR
}

enum MaterialApoyo {
  CONCRETO
  FIBRA_VIDRIO
  MADERA
  METALICO
}

enum AnguloApoyo {
  GRADOS_90
  GRADOS_30
}

enum AlturaApoyo {
  M_6_6_7
  M_4_6_5
  M_7_6_8
}

enum ZonaInventario {
  URBANA
  RURAL
}

enum AccesoInventario {
  VEHICULAR
  PEATONAL
}

enum EstadoInventario {
  ACTIVO
  SUSPENDIDO
}

enum PropietarioInventario {
  MUNICIPIO_YARUMAL
  ALUMBRADO_YARUMAL_SAS
}

enum TecnologiaLuminaria {
  LED
  SODIO
  HALOGENA
}

enum OrientacionLuminaria {
  HORIZONTAL
  VERTICAL
}

enum ControlLuminaria {
  FOTOCELDA
  NA
}

//////////////////
// MODELOS     //
//////////////////

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      Role     @default(OPERATOR)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  pqrsCreadas Pqr[] @relation("PqrCreador")

  @@map("users")
}

// Tabla Cliente
model Cliente {
  id          String   @id // Documento de identidad
  nombre      String
  telefono    String?
  correo      String?
  observacion String?

  pqrs        Pqr[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("clientes")
}

//////////////////
// PQR          //
//////////////////

model Pqr {
  id                    String       @id @default(uuid())
  prioridad             PrioridadPqr @default(BAJA)
  fechaPqr              DateTime     @default(now())
  clienteId             String
  medioReporte          MedioReporte
  tipoPqr               TipoPqr
  condicion             Condicion?
  hasSerie              Boolean      @default(false)
  serieLuminaria        String?
  direccionPqr          String
  sectorPqr             String?
  barrio                String?
  lat                   Float?
  lng                   Float?
  observacionPqr        String?
  estado                EstadoPqr    @default(PENDIENTE)
  plazoDias             Int
  fechaPlazo            DateTime?
  responsableAtencionId String?
  usuarioCreadorId      String
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  usuarioCreador        User         @relation("PqrCreador", fields: [usuarioCreadorId], references: [id])
  cliente               Cliente      @relation(fields: [clienteId], references: [id])
  luminaria             Inventario?  @relation(fields: [serieLuminaria], references: [serie])
  historial             PqrHistorial[]

  @@map("pqrs")
}

//////////////////
// HISTORIAL PQR //
//////////////////

model PqrHistorial {
  id         String   @id @default(uuid())
  pqrId      String
  proceso    String
  fecha      DateTime @default(now())
  usuarioId  String?
  comentario String?

  pqr Pqr @relation(fields: [pqrId], references: [id])

  @@index([pqrId])
  @@map("pqr_historial")
}

//////////////////
// INVENTARIO   //
//////////////////

model Inventario {
  id               Int       @id @default(autoincrement())
  serie            String    @unique
  tipo             TipoInventario
  potencia         Int?
  medida           Boolean?
  configuracion    String?
  trafo            String?
  voltaje          String?
  apoyo            String
  materialApoyo    MaterialApoyo?
  angulo           AnguloApoyo?
  altura           AlturaApoyo?
  zona             ZonaInventario
  acceso           AccesoInventario
  direccion        String
  sector           String
  barrio           String
  lat              Float
  lng              Float
  fechaIngreso     DateTime  @default(now())
  estado           EstadoInventario @default(ACTIVO)
  propietario      PropietarioInventario

  caracteristicaId Int? @unique
  caracteristica   CaracteristicaLuminaria? @relation(fields: [caracteristicaId], references: [id])

  pqrs        Pqr[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([serie])
  @@index([barrio])
  @@map("inventario")
}

//////////////////////////////////
// CARACTERISTICAS LUMINARIA   //
//////////////////////////////////

model CaracteristicaLuminaria {
  id            Int      @id @default(autoincrement())
  modelo        String
  fabricante    String
  serialFabrica String?
  tecnologia    TecnologiaLuminaria
  orientacion   OrientacionLuminaria
  control       ControlLuminaria

  inventario Inventario?

  @@map("caracteristicas_luminaria")
}
